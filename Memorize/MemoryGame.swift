//
//  MemoryGame.swift
//  Memorize
//
//  Created by sana on 2021/05/31.
//

import Foundation
import SwiftUI

struct MemoryGame<CardContent> where CardContent: Equatable {
    
    enum Theme {
        case vehicles, flags, gestures, foods, animals, nature, sports, music
        
        var color: Color {
            switch self {
            case .vehicles:
                return .red
            case .flags:
                return .pink
            case .gestures:
                return .blue
            case .foods:
                return .orange
            case .animals:
                return .gray
            case .nature:
                return .green
            case .sports:
                return .black
            case .music:
                return .purple
            }
        }
        
        var name: String {
            switch self {
            case .vehicles:
                return "Vehicles"
            case .flags:
                return "Flags"
            case .gestures:
                return "Gestures"
            case .foods:
                return "Body Parts"
            case .animals:
                return "Animals"
            case .nature:
                return "Nature"
            case .sports:
                return "Sports"
            case .music:
                return "Music"
            }
        }
        
        var emojis: [String] {
            switch self {
            case .vehicles:
                return [
                    "ğŸš²", "ğŸš‚", "ğŸš", "ğŸšœ", "ğŸš•", "ğŸ", "ğŸš‘", "ğŸš“", "ğŸš’", "âœˆï¸", "ğŸš€", "â›µï¸",
                    "ğŸ›¸", "ğŸ›¶", "ğŸšŒ", "ğŸ", "ğŸ›º", "ğŸš ", "ğŸ›µ", "ğŸš—", "ğŸšš", "ğŸš‡", "ğŸ›»", "ğŸš",]
            case .flags:
                return ["ğŸ³ï¸", "ğŸ´", "ğŸ", "ğŸš©", "ğŸ³ï¸â€ğŸŒˆ", "ğŸ³ï¸â€âš§ï¸", "ğŸ´â€â˜ ï¸", "ğŸ‡¦ğŸ‡«", "ğŸ‡¦ğŸ‡½", "ğŸ‡¦ğŸ‡±", "ğŸ‡©ğŸ‡¿", "ğŸ‡¦ğŸ‡¸", "ğŸ‡¦ğŸ‡©", "ğŸ‡¦ğŸ‡´", "ğŸ‡¦ğŸ‡®", "ğŸ‡¦ğŸ‡¶", "ğŸ‡¦ğŸ‡¬", "ğŸ‡¦ğŸ‡·", "ğŸ‡¦ğŸ‡²", "ğŸ‡¦ğŸ‡¼", "ğŸ‡¦ğŸ‡º", "ğŸ‡¦ğŸ‡¹", "ğŸ‡¦ğŸ‡¿", "ğŸ‡§ğŸ‡¸", "ğŸ‡§ğŸ‡­", "ğŸ‡§ğŸ‡©", "ğŸ‡§ğŸ‡§", "ğŸ‡§ğŸ‡¾", "ğŸ‡§ğŸ‡ª", "ğŸ‡§ğŸ‡¿", "ğŸ‡§ğŸ‡¯", "ğŸ‡§ğŸ‡²", "ğŸ‡§ğŸ‡¹", "ğŸ‡§ğŸ‡´", "ğŸ‡§ğŸ‡¦", "ğŸ‡§ğŸ‡¼", "ğŸ‡§ğŸ‡·", "ğŸ‡®ğŸ‡´", "ğŸ‡»ğŸ‡¬", "ğŸ‡§ğŸ‡³", "ğŸ‡§ğŸ‡¬", "ğŸ‡§ğŸ‡«", "ğŸ‡§ğŸ‡®", "ğŸ‡°ğŸ‡­", "ğŸ‡¨ğŸ‡²", "ğŸ‡¨ğŸ‡¦", "ğŸ‡®ğŸ‡¨", "ğŸ‡¨ğŸ‡»", "ğŸ‡§ğŸ‡¶", "ğŸ‡°ğŸ‡¾", "ğŸ‡¨ğŸ‡«", "ğŸ‡¹ğŸ‡©", "ğŸ‡¨ğŸ‡±", "ğŸ‡¨ğŸ‡³", "ğŸ‡¨ğŸ‡½", "ğŸ‡¨ğŸ‡¨", "ğŸ‡¨ğŸ‡´", "ğŸ‡°ğŸ‡²", "ğŸ‡¨ğŸ‡¬", "ğŸ‡¨ğŸ‡©", "ğŸ‡¨ğŸ‡°", "ğŸ‡¨ğŸ‡·", "ğŸ‡¨ğŸ‡®", "ğŸ‡­ğŸ‡·", "ğŸ‡¨ğŸ‡º", "ğŸ‡¨ğŸ‡¼", "ğŸ‡¨ğŸ‡¾", "ğŸ‡¨ğŸ‡¿", "ğŸ‡©ğŸ‡°", "ğŸ‡©ğŸ‡¯", "ğŸ‡©ğŸ‡²", "ğŸ‡©ğŸ‡´", "ğŸ‡ªğŸ‡¨", "ğŸ‡ªğŸ‡¬", "ğŸ‡¸ğŸ‡»", "ğŸ‡¬ğŸ‡¶", "ğŸ‡ªğŸ‡·", "ğŸ‡ªğŸ‡ª", "ğŸ‡ªğŸ‡¹", "ğŸ‡ªğŸ‡º", "ğŸ‡«ğŸ‡°", "ğŸ‡«ğŸ‡´", "ğŸ‡«ğŸ‡¯", "ğŸ‡«ğŸ‡®", "ğŸ‡«ğŸ‡·", "ğŸ‡¬ğŸ‡«", "ğŸ‡µğŸ‡«", "ğŸ‡¹ğŸ‡«", "ğŸ‡¬ğŸ‡¦", "ğŸ‡¬ğŸ‡²", "ğŸ‡¬ğŸ‡ª", "ğŸ‡©ğŸ‡ª", "ğŸ‡¬ğŸ‡­", "ğŸ‡¬ğŸ‡®", "ğŸ‡¬ğŸ‡·", "ğŸ‡¬ğŸ‡±", "ğŸ‡¬ğŸ‡©", "ğŸ‡¬ğŸ‡µ", "ğŸ‡¬ğŸ‡º", "ğŸ‡¬ğŸ‡¹", "ğŸ‡¬ğŸ‡¬", "ğŸ‡¬ğŸ‡³", "ğŸ‡¬ğŸ‡¼", "ğŸ‡¬ğŸ‡¾", "ğŸ‡­ğŸ‡¹", "ğŸ‡­ğŸ‡³", "ğŸ‡­ğŸ‡°", "ğŸ‡­ğŸ‡º", "ğŸ‡®ğŸ‡¸", "ğŸ‡®ğŸ‡³", "ğŸ‡®ğŸ‡©", "ğŸ‡®ğŸ‡·", "ğŸ‡®ğŸ‡¶", "ğŸ‡®ğŸ‡ª", "ğŸ‡®ğŸ‡²", "ğŸ‡®ğŸ‡±", "ğŸ‡®ğŸ‡¹", "ğŸ‡¯ğŸ‡²", "ğŸ‡¯ğŸ‡µ", "ğŸŒ", "ğŸ‡¯ğŸ‡ª", "ğŸ‡¯ğŸ‡´", "ğŸ‡°ğŸ‡¿", "ğŸ‡°ğŸ‡ª", "ğŸ‡°ğŸ‡®", "ğŸ‡½ğŸ‡°", "ğŸ‡°ğŸ‡¼", "ğŸ‡°ğŸ‡¬", "ğŸ‡±ğŸ‡¦", "ğŸ‡±ğŸ‡»", "ğŸ‡±ğŸ‡§", "ğŸ‡±ğŸ‡¸", "ğŸ‡±ğŸ‡·", "ğŸ‡±ğŸ‡¾", "ğŸ‡±ğŸ‡®", "ğŸ‡±ğŸ‡¹", "ğŸ‡±ğŸ‡º", "ğŸ‡²ğŸ‡´", "ğŸ‡²ğŸ‡°", "ğŸ‡²ğŸ‡¬", "ğŸ‡²ğŸ‡¼", "ğŸ‡²ğŸ‡¾", "ğŸ‡²ğŸ‡»", "ğŸ‡²ğŸ‡±", "ğŸ‡²ğŸ‡¹", "ğŸ‡²ğŸ‡­", "ğŸ‡²ğŸ‡¶", "ğŸ‡²ğŸ‡·", "ğŸ‡²ğŸ‡º", "ğŸ‡¾ğŸ‡¹", "ğŸ‡²ğŸ‡½", "ğŸ‡«ğŸ‡²", "ğŸ‡²ğŸ‡©", "ğŸ‡²ğŸ‡¨", "ğŸ‡²ğŸ‡³", "ğŸ‡²ğŸ‡ª", "ğŸ‡²ğŸ‡¸", "ğŸ‡²ğŸ‡¦", "ğŸ‡²ğŸ‡¿", "ğŸ‡²ğŸ‡²", "ğŸ‡³ğŸ‡¦", "ğŸ‡³ğŸ‡·", "ğŸ‡³ğŸ‡µ", "ğŸ‡³ğŸ‡±", "ğŸ‡³ğŸ‡¨", "ğŸ‡³ğŸ‡¿", "ğŸ‡³ğŸ‡®", "ğŸ‡³ğŸ‡ª", "ğŸ‡³ğŸ‡¬", "ğŸ‡³ğŸ‡º", "ğŸ‡³ğŸ‡«", "ğŸ‡°ğŸ‡µ", "ğŸ‡²ğŸ‡µ", "ğŸ‡³ğŸ‡´", "ğŸ‡´ğŸ‡²", "ğŸ‡µğŸ‡°", "ğŸ‡µğŸ‡¼", "ğŸ‡µğŸ‡¸", "ğŸ‡µğŸ‡¦", "ğŸ‡µğŸ‡¬", "ğŸ‡µğŸ‡¾", "ğŸ‡µğŸ‡ª", "ğŸ‡µğŸ‡­", "ğŸ‡µğŸ‡³", "ğŸ‡µğŸ‡±", "ğŸ‡µğŸ‡¹", "ğŸ‡µğŸ‡·", "ğŸ‡¶ğŸ‡¦", "ğŸ‡·ğŸ‡ª", "ğŸ‡·ğŸ‡´", "ğŸ‡·ğŸ‡º", "ğŸ‡·ğŸ‡¼", "ğŸ‡¼ğŸ‡¸", "ğŸ‡¸ğŸ‡²", "ğŸ‡¸ğŸ‡¦", "ğŸ‡¸ğŸ‡³", "ğŸ‡·ğŸ‡¸", "ğŸ‡¸ğŸ‡¨", "ğŸ‡¸ğŸ‡±", "ğŸ‡¸ğŸ‡¬", "ğŸ‡¸ğŸ‡½", "ğŸ‡¸ğŸ‡°", "ğŸ‡¸ğŸ‡®", "ğŸ‡¬ğŸ‡¸", "ğŸ‡¸ğŸ‡§", "ğŸ‡¸ğŸ‡´", "ğŸ‡¿ğŸ‡¦", "ğŸ‡°ğŸ‡·", "ğŸ‡¸ğŸ‡¸", "ğŸ‡ªğŸ‡¸", "ğŸ‡±ğŸ‡°", "ğŸ‡§ğŸ‡±", "ğŸ‡¸ğŸ‡­", "ğŸ‡°ğŸ‡³", "ğŸ‡±ğŸ‡¨", "ğŸ‡µğŸ‡²", "ğŸ‡»ğŸ‡¨", "ğŸ‡¸ğŸ‡©", "ğŸ‡¸ğŸ‡·", "ğŸ‡¸ğŸ‡¿", "ğŸ‡¸ğŸ‡ª", "ğŸ‡¨ğŸ‡­", "ğŸ‡¸ğŸ‡¾", "ğŸ‡¹ğŸ‡¼", "ğŸ‡¹ğŸ‡¯", "ğŸ‡¹ğŸ‡¿", "ğŸ‡¹ğŸ‡­", "ğŸ‡¹ğŸ‡±", "ğŸ‡¹ğŸ‡¬", "ğŸ‡¹ğŸ‡°", "ğŸ‡¹ğŸ‡´", "ğŸ‡¹ğŸ‡¹", "ğŸ‡¹ğŸ‡³", "ğŸ‡¹ğŸ‡·", "ğŸ‡¹ğŸ‡²", "ğŸ‡¹ğŸ‡¨", "ğŸ‡¹ğŸ‡»", "ğŸ‡»ğŸ‡®", "ğŸ‡ºğŸ‡¬", "ğŸ‡ºğŸ‡¦", "ğŸ‡¦ğŸ‡ª", "ğŸ‡¬ğŸ‡§", "ğŸ´ó §ó ¢ó ¥ó ®ó §ó ¿", "ğŸ´ó §ó ¢ó ³ó £ó ´ó ¿", "ğŸ´ó §ó ¢ó ·ó ¬ó ³ó ¿", "ğŸ‡ºğŸ‡³", "ğŸ‡ºğŸ‡¸", "ğŸ‡ºğŸ‡¾", "ğŸ‡ºğŸ‡¿", "ğŸ‡»ğŸ‡º", "ğŸ‡»ğŸ‡¦", "ğŸ‡»ğŸ‡ª", "ğŸ‡»ğŸ‡³", "ğŸ‡¼ğŸ‡«", "ğŸ‡ªğŸ‡­", "ğŸ‡¾ğŸ‡ª", "ğŸ‡¿ğŸ‡²", "ğŸ‡¿ğŸ‡¼"]
            case .gestures:
                return ["ğŸ‘‹", "ğŸ¤š", "ğŸ–", "âœ‹", "ğŸ––", "ğŸ‘Œ", "ğŸ¤Œ", "ğŸ¤", "âœŒï¸", "ğŸ¤", "ğŸ¤Ÿ", "ğŸ¤˜", "ğŸ¤™", "ğŸ‘ˆ", "ğŸ‘‰", "ğŸ‘†", "ğŸ–•", "ğŸ‘‡", "â˜ï¸", "ğŸ‘", "ğŸ‘", "âœŠ", "ğŸ‘Š", "ğŸ¤›", "ğŸ¤œ", "ğŸ‘", "ğŸ™Œ", "ğŸ‘", "ğŸ¤²", "ğŸ¤", "ğŸ™"]
            case .foods:
                return ["ğŸ", "ğŸ", "ğŸ", "ğŸŠ", "ğŸ‹", "ğŸŒ", "ğŸ‰", "ğŸ‡", "ğŸ“", "ğŸ«", "ğŸˆ", "ğŸ’", "ğŸ‘", "ğŸ¥­", "ğŸ", "ğŸ¥¥", "ğŸ¥", "ğŸ…", "ğŸ†", "ğŸ¥‘", "ğŸ¥¦", "ğŸ¥¬", "ğŸ¥’", "ğŸŒ¶", "ğŸ«‘", "ğŸŒ½", "ğŸ¥•", "ğŸ«’", "ğŸ§„", "ğŸ§…", "ğŸ¥”", "ğŸ ", "ğŸ¥", "ğŸ¥¯", "ğŸ", "ğŸ¥–", "ğŸ¥¨", "ğŸ§€", "ğŸ¥š", "ğŸ³", "ğŸ§ˆ", "ğŸ¥", "ğŸ§‡", "ğŸ¥“", "ğŸ¥©", "ğŸ—", "ğŸ–", "ğŸ¦´", "ğŸŒ­", "ğŸ”", "ğŸŸ", "ğŸ•", "ğŸ«“", "ğŸ¥ª", "ğŸ¥™", "ğŸ§†", "ğŸŒ®", "ğŸŒ¯", "ğŸ«”", "ğŸ¥—", "ğŸ¥˜", "ğŸ«•", "ğŸ¥«", "ğŸ", "ğŸœ", "ğŸ²", "ğŸ›", "ğŸ£", "ğŸ±", "ğŸ¥Ÿ", "ğŸ¦ª", "ğŸ¤", "ğŸ™", "ğŸš", "ğŸ˜", "ğŸ¥", "ğŸ¥ ", "ğŸ¥®", "ğŸ¢", "ğŸ¡", "ğŸ§", "ğŸ¨", "ğŸ¦", "ğŸ¥§", "ğŸ§", "ğŸ°", "ğŸ‚", "ğŸ®", "ğŸ­", "ğŸ¬", "ğŸ«", "ğŸ¿", "ğŸ©", "ğŸª", "ğŸŒ°", "ğŸ¥œ", "ğŸ¯"]
            case .animals:
                return ["ğŸ¶", "ğŸ±", "ğŸ­", "ğŸ¹", "ğŸ°", "ğŸ¦Š", "ğŸ»", "ğŸ¼", "ğŸ»â€â„ï¸", "ğŸ¨", "ğŸ¯", "ğŸ¦", "ğŸ®", "ğŸ·", "ğŸ½", "ğŸ¸", "ğŸµ", "ğŸ™ˆ", "ğŸ™‰", "ğŸ™Š", "ğŸ’", "ğŸ”", "ğŸ§", "ğŸ¦", "ğŸ¤", "ğŸ£", "ğŸ¥", "ğŸ¦†", "ğŸ¦…", "ğŸ¦‰", "ğŸ¦‡", "ğŸº", "ğŸ—", "ğŸ´", "ğŸ¦„", "ğŸ", "ğŸª±", "ğŸ›", "ğŸ¦‹", "ğŸŒ", "ğŸ", "ğŸœ", "ğŸª°", "ğŸª²", "ğŸª³", "ğŸ¦Ÿ", "ğŸ¦—", "ğŸ•·", "ğŸ•¸", "ğŸ¦‚", "ğŸ¢", "ğŸ", "ğŸ¦", "ğŸ¦–", "ğŸ¦•", "ğŸ™", "ğŸ¦‘", "ğŸ¦", "ğŸ¦", "ğŸ¦€", "ğŸ¡", "ğŸ ", "ğŸŸ", "ğŸ¬", "ğŸ³", "ğŸ‹", "ğŸ¦ˆ", "ğŸŠ", "ğŸ…", "ğŸ†", "ğŸ¦“", "ğŸ¦", "ğŸ¦§", "ğŸ¦£", "ğŸ˜", "ğŸ¦›", "ğŸ¦", "ğŸª", "ğŸ«", "ğŸ¦’", "ğŸ¦˜", "ğŸ¦¬", "ğŸƒ", "ğŸ‚", "ğŸ„", "ğŸ", "ğŸ–", "ğŸ", "ğŸ‘", "ğŸ¦™", "ğŸ", "ğŸ¦Œ", "ğŸ•", "ğŸ©", "ğŸ¦®", "ğŸ•â€ğŸ¦º", "ğŸˆ", "ğŸˆâ€â¬›", "ğŸª¶", "ğŸ“", "ğŸ¦ƒ", "ğŸ¦¤", "ğŸ¦š", "ğŸ¦œ", "ğŸ¦¢", "ğŸ¦©", "ğŸ•Š", "ğŸ‡", "ğŸ¦", "ğŸ¦¨", "ğŸ¦¡", "ğŸ¦«", "ğŸ¦¦", "ğŸ¦¥", "ğŸ", "ğŸ€", "ğŸ¿", "ğŸ¦”", "ğŸ¾", "ğŸ‰", "ğŸ²"]
            case .nature:
                return ["ğŸŒµ", "ğŸ„", "ğŸŒ²", "ğŸŒ³", "ğŸŒ´", "ğŸªµ", "ğŸŒ±", "ğŸŒ¿", "â˜˜ï¸", "ğŸ€", "ğŸ", "ğŸª´", "ğŸ‹", "ğŸƒ", "ğŸ‚", "ğŸ", "ğŸ„", "ğŸš", "ğŸª¨", "ğŸŒ¾", "ğŸ’", "ğŸŒ·", "ğŸŒ¹", "ğŸ¥€", "ğŸŒº", "ğŸŒ¸", "ğŸŒ¼", "ğŸŒ»"]
            case .sports:
                return ["âš½ï¸", "ğŸ€", "ğŸˆ", "âš¾ï¸", "ğŸ¥", "ğŸ¾", "ğŸ", "ğŸ‰", "ğŸ¥", "ğŸ±", "ğŸª€", "ğŸ“", "ğŸ¸", "ğŸ’", "ğŸ‘", "ğŸ¥", "ğŸ", "ğŸªƒ", "ğŸ¥…", "â›³ï¸", "ğŸª", "ğŸ¹", "ğŸ£", "ğŸ¤¿", "ğŸ¥Š", "ğŸ¥‹", "ğŸ½", "ğŸ›¹", "ğŸ›¼", "ğŸ›·", "â›¸", "ğŸ¥Œ", "ğŸ¿", "â›·", "ğŸ‚", "ğŸª‚", "ğŸ®"]
            case .music:
                return ["ğŸ¤", "ğŸ§", "ğŸ¼", "ğŸ¹", "ğŸ¥", "ğŸª˜", "ğŸ·", "ğŸº", "ğŸª—", "ğŸ¸", "ğŸª•", "ğŸ»"]
            }
        }
        
        var pairCount: Int {
            let max = 10 < emojis.count ? 10 : emojis.count
            return Int.random(in: 4..<max)
        }
    }
    
    private(set) var cards: [Card]
    
    private var indexOfTheOneAndOnlyFaceUpCard: Int?
    
    mutating func choose(_ card: Card) {
        guard let chosenIndex = cards.firstIndex(where: { $0.id == card.id }),
              !cards[chosenIndex].isFaceUp,
              !cards[chosenIndex].isMatched else {
            return
        }
        
        if let potentialMatchIndex = indexOfTheOneAndOnlyFaceUpCard {
            
            if cards[chosenIndex].content == cards[potentialMatchIndex].content {
                cards[chosenIndex].isMatched = true
                cards[potentialMatchIndex].isMatched = true
            }
            indexOfTheOneAndOnlyFaceUpCard = nil
        } else {
            for index in cards.indices {
                cards[index].isFaceUp = false
            }
            indexOfTheOneAndOnlyFaceUpCard = chosenIndex
        }
        cards[chosenIndex].isFaceUp.toggle()
    }
    
    
    init(numberOfPairOfCards: Int, createCardContent: (Int) -> CardContent) {
        cards = []
        // add numberOfPairCards x 2 cards to cards array
        (0..<numberOfPairOfCards).forEach { index in
            let content = createCardContent(index)
            cards.append(Card(content: content, id: index*2))
            cards.append(Card(content: content, id: index*2 + 1))
        }
    }
    
    struct Card: Identifiable {
        var isFaceUp = false
        var isMatched = false
        var content: CardContent
        var id: Int
    }
}
